---
title: "一篇关于编译器注入后门的文章"
date: 2023-09-26T16:00:47+08:00
categories:
- 收件箱
- 安全相关
tags:
- 安全
- 案例
keywords:
- 案例
#thumbnailImage: //example.com/image.jpg
---

<!--more-->
1984 年的时候，UNIX 创造者之一 Ken Thompson 获得了 ACM 图灵奖。他的获奖演讲叫做 Reflections on Trusting Trust（反思对信任的信任）。

在这个稿子只有三页纸的演讲中他分三步描述了如何构造一个非常难以被发现的编译器后门。这后来被称为 the Ken Thompson Hack（KTH），有人说它是 the root password of all evil。

在第一步里，Thompson 展示了一个可以输出自己的源代码的 C 程序。这需要一定技巧，但很多人作为编程练习都做过。

在第二步里，Thompson 在 C 的编译器里增加了一段代码（后门），让它在检测到自己在编译 UNIX 的 login 命令时在输出里插入一个后门。这个后门会允许作者用特定密码以 root 身份登录系统。

在第三步里，Thompson 在第二步的编译器里使用第一步的方法加入另一段代码（后门生成器），使得这个编译器在检测到它在编译自己时自动把第二步的后门和第三步的后门生成器插入到输出里。

在得到一个第三步的编译器后，就可以把第二、三步新增的代码从源代码里删除，因为这个新的编译器在编译它自己原来「干净」的源代码时会自动把后门和后门生成器加上。很多语言的编译器都会使用「自举」的方式编译，也就是会用一个编译器的旧版本可执行文件来编译新版本的源码，所以这样一个高危的后门完全可以在一个开源项目里存在。通过阅读这个编译器的源码是无法发现这个后门的。

Thompson 在演讲里的结论是：即使开源项目也无法保证安全。在不考虑硬件或 microcode 后门的情况下，只有当运行的每一个程序都完全是自己写的时才能确保安全。